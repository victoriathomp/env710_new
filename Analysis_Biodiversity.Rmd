---
title: "Biodiversity_Riparian_Forest"
author: "Camila Rodriguez"
date: "2025-03-05"
output: html_document
---
## Setup and load datasets 
```{r setup, include=FALSE}

Fish_salamander<- read.csv('Data/AS01001_v1.csv')
#invertebrate<- read.csv('Data/AS01002_v1.csv') provided but not needed for our analysis
stream_data<- read.csv('Data/AS01003_v1.csv')
wood_measurements<- read.csv('Data/AS01004_v1.csv')
pool_measurement<-read.csv('Data/AS01005_v1.csv')

<<<<<<< HEAD
#install.packages("dplyr")
#install.packages("tidyverse")
library(ggplot2)
library (patchwork)
library(dplyr)
library(tidyverse)
=======
```

### Exploratory Image 1 
```{r figure 1, fig.cap = "Distribution of stream characteristics (maximum depth, depth at outflow, stream width, and stream length) in old-growth forest riparian zones and secondary growth riparian zones.}
binnumber <- 2 * (172)^(1/3)
binnumber

depth_plot <-  ggplot(pool_measurement, aes(x = DEPTH_MAX, fill = REACH_TYPE)) +
geom_histogram(bins = 11) + # creates histograms
  facet_wrap (~ REACH_TYPE) +
  scale_fill_manual(values= c('seagreen3', 'dodgerblue')) +
labs(x = "Depth (cm)",
y = "Count", title = "Figure 1. Distribution of stream characteristics by forest treatment") +
   theme_bw() + theme(legend.position = "none") 

flowdepth_plot <-  ggplot(pool_measurement, aes(x = DEPTH_OUTFLOW, fill = REACH_TYPE)) +
geom_histogram(bins = 11) + # creates histograms
  facet_wrap (~ REACH_TYPE) +
  scale_fill_manual(values= c('seagreen3', 'dodgerblue')) +
labs(x = "Depth at stream outflow (cm)",
y = "Count") +
  theme_bw() + theme(legend.position = "none") 

width_plot <-  ggplot(pool_measurement, aes(x = WIDTH, fill = REACH_TYPE)) +
geom_histogram(bins = 11) + # creates histograms
  facet_wrap (~ REACH_TYPE) +
  scale_fill_manual(values= c('seagreen3', 'dodgerblue')) +
labs(x = "Pool width (cm)",
y = "Count") +
   theme_bw() + theme(legend.position = "none")

length_plot <-  ggplot(pool_measurement, aes(x = POOL_LENGTH, fill = REACH_TYPE)) +
geom_histogram(bins = 11) + # creates histograms
  facet_wrap (~ REACH_TYPE) +
  scale_fill_manual(values= c('seagreen3', 'dodgerblue')) +
labs(x = "Pool length (cm)",
y = "Count", caption = "Figure 1. Distribution of stream characteristics
(maximum depth, depth at outflow, stream width, and stream length) in 
old-growth forest riparian zones and secondary growth riparian zones. 
Data collected July-October 2014 by HJ Andrews LTER") +
  theme_bw() + theme(legend.position = "none")


stream_qualities_plot <- depth_plot / flowdepth_plot / width_plot / length_plot 
stream_qualities_plot

ggsave("stream_qualities_plot.jpeg", stream_qualities_plot, width = 8, height = 14)

```

### Exploratory histograms 
```{r other-plots}
(hist.maxdepth <- ggplot(pool_measurement, aes(x=DEPTH_MAX))+ geom_histogram(bins = 11) + theme_bw())
(hist.outflowdepth <- ggplot(pool_measurement, aes(x=DEPTH_OUTFLOW))+ geom_histogram(bins = 11) + theme_bw())
(hist.poollength <- ggplot(pool_measurement, aes(x=POOL_LENGTH))+ geom_histogram(bins = 11) + theme_bw())
(hist.width <- ggplot(pool_measurement, aes(x=WIDTH))+ geom_histogram(bins = 11) + theme_bw())
##

```

### Expploratory Image 2
```{r figure2, fig.cap = "Canopy Cover vs. Chlorophyll-a and Woody Debris Effect on Stream Structure"}
# Canopy Cover vs. Chlorophyll-a (LOCKED)
# Based on visible clues in the data, we removed points where canopy cover is < 35%.
clean_canopy_data <- transect_data_sites %>%
  filter(CANOPY_COVER >= 35)

canopy_plot <- ggplot(clean_canopy_data, aes(x = REACH_TYPE, y = CHL_A_TILES, fill = REACH_TYPE)) +
  geom_boxplot(outlier.shape = NA, alpha = 0.6) +
  geom_jitter(aes(color = REACH_TYPE), width = 0.2, size = 1.5, alpha = 0.5) +
  scale_fill_manual(values = c("seagreen3", "dodgerblue")) +
  scale_color_manual(values = c("seagreen4", "blue4")) +
  labs(
    x = "Forest Type",
    y = "Chlorophyll-a Concentration (µg/cm²)",
    title = "Chlorophyll-a Levels in Old-Growth vs. Secondary Forests"
  ) +
  theme_bw() +
  theme(legend.position = "none")

# Separate Histograms for OG and SG
wood_histogram <- ggplot(wood_measurements, aes(x = WOOD_LENGTH, fill = REACH_TYPE)) +
  geom_histogram(bins = 15, alpha = 0.7) +  # Individual histograms
  scale_fill_manual(values = c("seagreen3", "dodgerblue")) +
  scale_x_log10() +  # Log scale for better spread
  facet_wrap(~ REACH_TYPE) +  # Separate plots for OG and SG
  labs(
    x = "Woody Debris Length (log scale, cm)",
    y = "Count",
    title = "Woody Debris Size Distribution by Forest Type"
  ) +
  theme_bw() +
  theme(legend.position = "none")

# Combine Both Plots into One Figure with Proper Caption Spacing 
combined_figure <- canopy_plot / wood_histogram +
  plot_annotation(
    caption = "Figure 2. Distribution of woody debris sizes in old-growth forest riparian zones and secondary growth riparian zones. Data collected July-October 2014 by HJ Andrews LTER."
  ) &
  theme(
    plot.caption = element_text(hjust = 0.5, size = 10, face = "italic")  # Ensures proper alignment
  )

# Save the figure with increased width
ggsave("canopy_woodydebris.jpeg", combined_figure, width = 14, height = 10)  # Increased width

# Display the figure
combined_figure
```

## Abundance
```{r}

salamander<- Fish_salamander %>% filter(SPECIES== "DITE")%>%
  mutate(SPECIES_NAME = "Dicamptodon tenebrosus (Coastal Giant Salamander)")

salamander_abundance_by_pair <- function(salamander, correction_factor = 1.34) {
  
  salamander <- salamander %>%
    mutate(SURVEY_METHOD = toupper(SURVEY_METHOD),
           MARKED_UNMARKED = toupper(MARKED_UNMARKED))
  
  # Combine SITE and REACH_TYPE to define unique pairs
  site_pairs <- salamander %>%
    select(SITE, REACH_TYPE) %>%
    distinct()
  
  results <- data.frame(
    SITE = character(),
    REACH_TYPE = character(),
    Abundance_Estimate = numeric(),
    Method = character(),
    stringsAsFactors = FALSE
  )
  
  for (i in 1:nrow(site_pairs)) {
    site <- site_pairs$SITE[i]
    reach <- site_pairs$REACH_TYPE[i]
    
    pair_data <- salamander %>%
      filter(SITE == site, REACH_TYPE == reach)
    
    if (site %in% c("MCT_E", "MCT_W")) {
      raw_count <- pair_data %>%
        filter(SURVEY_METHOD %in% c("P1", "P2", "P3")) %>%
        nrow()
      est <- raw_count * correction_factor
      method <- "Depletion (corrected)"
      
    } else if (all(c("M", "R") %in% unique(pair_data$SURVEY_METHOD))) {
      M <- pair_data %>%
        filter(SURVEY_METHOD == "M", MARKED_UNMARKED == "M") %>%
        nrow()
      C <- pair_data %>%
        filter(SURVEY_METHOD == "R") %>%
        nrow()
      R <- pair_data %>%
        filter(SURVEY_METHOD == "R", MARKED_UNMARKED == "M") %>%
        nrow()
      
      est <- if (R > 0) ((M + 1) * (C + 1)) / (R + 1) - 1 else NA
      method <- "Mark-recapture"
      
    } else {
      est <- NA
      method <- "Insufficient data"
    }
    
    results <- rbind(
      results,
      data.frame(SITE = site, REACH_TYPE = reach,
                 Abundance_Estimate = round(est, 2),
                 Method = method,
                 stringsAsFactors = FALSE)
    )
  }
  
  return(results)
}

abundance_by_pair <- salamander_abundance_by_pair(salamander)
print(abundance_by_pair)

```
### Model 1
```{r}
#Salamander abundance as a function of canopy cover and wetted width (poisson)
#DITE – Dicamptodon tenebrosus (Coastal Giant Salamander)
#Poisson regression because we are interested in abundance 

#salamander_abundance_reachtype <- salamander %>%
  group_by(REACH_TYPE, DATE) %>%
  summarise(abundance = n(), .groups = "drop")

model1 <- lm(salamander_abundance_reachtype ~ CANOPY_COVER + wetted_width, data = salamander)
```

